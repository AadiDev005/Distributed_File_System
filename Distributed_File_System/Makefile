.PHONY: api dashboard enterprise clean help install dev collab-test kill-ports status build test

# ğŸ† DataVault Enterprise - Development Commands
# ===============================================

help: ## Show this help message
	@echo "ğŸ† DataVault Enterprise - Development Commands"
	@echo "=============================================="
	@echo "Phase 1.5: Collaboration Interface Implementation"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

api: ## Start Main Enterprise Server with WebSocket Collaboration (port 3000)
	@echo "ğŸš€ Starting DataVault Enterprise Server with Collaboration..."
	@echo "ğŸ“Š Serving enterprise metrics and WebSocket collaboration"
	@echo "ğŸ† DataVault Enterprise - Dashboard API Service"
	@echo "==============================================="
	@echo "ğŸ“Š Phase 1.5: Collaboration Interface"
	@echo ""
	@echo "ğŸš€ API Server: http://localhost:3000"
	@echo "ğŸ¯ Next.js Dashboard: http://localhost:3001/dashboard"
	@echo "ğŸ“ˆ Metrics: 40% efficiency, 60% security, 35% performance"
	@echo "ğŸ›¡ï¸ Security: All 11 enterprise layers active"
	@echo "ğŸ“‹ Compliance: 100% audit compliance"
	@echo ""
	@echo "âœ… All API endpoints ready for dashboard integration!"
	@go run main.go server.go auth.go collaboration_fix.go operational_transform_engine.go workflow_management_engine.go policy_recommendation_engine.go immutable_audit_trail.go gdpr_compliance_engine.go pii_detection_compliance.go continuous_authentication.go attribute_based_encryption.go threshold_secret_sharing.go zero_trust_advanced.go dynamic_sharding.go post_quantum_crypto.go byzantine_fault_tolerance.go

dashboard: ## Start Next.js Executive Dashboard (port 3001)
	@echo "ğŸ“Š Starting DataVault Executive Dashboard..."
	@echo "ğŸ¯ Navigate to: http://localhost:3001/dashboard"
	@cd datavault-dashboard && npm run dev

enterprise: ## Start Enterprise P2P Server (same as api)
	@echo "ğŸ—ï¸  Starting DataVault Enterprise Server..."
	@echo "ğŸ›¡ï¸ All 11 security layers will be initialized"
	@make api

dev: ## Start Enterprise Server + Dashboard together
	@echo "ğŸš€ Starting DataVault Enterprise Development Environment..."
	@echo "âš¡ API Server will start on: http://localhost:3000"
	@echo "ğŸ“Š Dashboard will start on: http://localhost:3001/dashboard"
	@make api &
	@sleep 3
	@make dashboard

collab-test: ## Test WebSocket collaboration endpoint
	@echo "ğŸ” Testing WebSocket collaboration..."
	@curl -i -N \
		-H "Connection: Upgrade" \
		-H "Upgrade: websocket" \
		-H "Sec-WebSocket-Version: 13" \
		-H "Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==" \
		-H "X-Session-ID: test-session" \
		"http://localhost:3000/ws/collaboration"

kill-ports: ## Kill processes on ports 3000 and 3001
	@echo "ğŸ”¥ Killing processes on ports 3000 and 3001..."
	@-sudo kill -9 $$(lsof -t -i:3000) 2>/dev/null || true
	@-sudo kill -9 $$(lsof -t -i:3001) 2>/dev/null || true
	@echo "âœ… Ports cleared!"

status: ## Check what's running on ports
	@echo "ğŸ” Checking port status..."
	@echo "Port 3000:"
	@lsof -i :3000 || echo "  - Available"
	@echo "Port 3001:"
	@lsof -i :3001 || echo "  - Available"

install: ## Install frontend dependencies
	@echo "ğŸ“¦ Installing frontend dependencies..."
	@cd datavault-dashboard && npm install

build: ## Build the entire project
	@echo "ğŸ—ï¸  Building DataVault Enterprise..."
	@go build -o datavault-server main.go server.go auth.go collaboration_fix.go operational_transform_engine.go workflow_management_engine.go policy_recommendation_engine.go immutable_audit_trail.go gdpr_compliance_engine.go pii_detection_compliance.go continuous_authentication.go attribute_based_encryption.go threshold_secret_sharing.go zero_trust_advanced.go dynamic_sharding.go post_quantum_crypto.go byzantine_fault_tolerance.go
	@cd datavault-dashboard && npm run build

test: ## Run tests
	@echo "ğŸ§ª Running tests..."
	@go test ./...
	@cd datavault-dashboard && npm test

clean: ## Clean all build artifacts
	@echo "ğŸ§¹ Cleaning DataVault Enterprise build artifacts..."
	@go clean
	@rm -f datavault-server
	@cd datavault-dashboard && rm -rf .next node_modules/.cache
	@echo "âœ… Cleanup complete!"

.DEFAULT_GOAL := help
